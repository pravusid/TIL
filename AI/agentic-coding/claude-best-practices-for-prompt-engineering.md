# claude best-practices-for-prompt-engineering

<https://www.claude.com/blog/best-practices-for-prompt-engineering>

## Advanced prompt engineering techniques

### Prefill the AI's response

```python
messages=[
    {"role": "user", "content": "Extract the name and price from this product description into JSON."},
    {"role": "assistant", "content": "{"}
]
```

### chain of thought prompting

Chain of thought (CoT) 프롬프팅은 답변 전에 단계별 추론을 요청하는 것을 포함합니다. 이 기법은 구조화된 사고의 이점을 얻는 복잡한 분석 작업에 도움이 됩니다.

현대적 접근 방식: Claude는 구조화된 추론을 자동화하는 확장된 사고(extended thinking) 기능을 제공합니다. 이 기능을 사용할 수 있는 경우, 일반적으로 확장된 사고가 수동적인 Chain of thought 프롬프팅보다 선호됩니다. 하지만, 확장된 사고를 사용할 수 없거나 검토할 수 있는 투명한 추론이 필요할 때를 대비하여 수동 CoT를 이해하는 것은 여전히 중요합니다.

Chain of thought를 사용해야 하는 경우:

- 확장된 사고를 사용할 수 없는 경우 (예: 무료 Claude.ai 플랜)
- 검토할 수 있는 투명한 추론이 필요한 경우
- 작업에 여러 분석 단계가 필요한 경우
- AI가 특정 요소를 고려하도록 확실히 하고 싶은 경우

Chain of thought의 일반적인 세 가지 구현 방식이 있습니다:

기본 Chain of thought
단순히 지침에 "단계별로 생각하세요(Think step-by-step)"를 추가합니다.

```prompt
Draft personalized emails to donors asking for contributions to this year's Care for Kids program.

Program information:
<program>
{{PROGRAM_DETAILS}}
</program>

Donor information:
<donor>
{{DONOR_DETAILS}}
</donor>

Think step-by-step before you write the email.
```

안내된 Chain of thought
구체적인 추론 단계를 제공하도록 프롬프트를 구성합니다.

```prompt
이메일을 작성하기 전에 생각하세요. 먼저, 기부 내역을 고려할 때 이 기부자에게 어필할 수 있는 메시지가 무엇인지 깊이 생각하세요. 다음으로, Care for Kids 프로그램의 어떤 측면이 그들에게 공감될지 고려하세요. 마지막으로, 분석을 사용하여 맞춤형 기부자 이메일을 작성하세요.
```

구조화된 Chain of thought
태그를 사용하여 추론과 최종 답변을 분리합니다.

```prompt
<thinking> 태그 안에 이메일을 작성하기 전에 생각하세요. 먼저, 이 기부자에게 어필할 수 있는 메시지를 분석하세요. 다음으로, 관련 프로그램 측면을 식별하세요. 마지막으로, 분석을 사용하여 <email> 태그 안에 맞춤형 기부자 이메일을 작성하세요.
```

참고: 확장된 사고를 사용할 수 있는 경우에도, 명시적인 CoT 프롬프팅은 복잡한 작업에 여전히 도움이 될 수 있습니다. 이 두 접근 방식은 상호 보완적이며 상호 배타적이지 않습니다.

### 출력 형식 제어 (Control the output format)

최신 AI 모델의 경우 응답 형식을 제어하는 몇 가지 효과적인 방법이 있습니다.

1. **AI에게 '하지 말아야 할 것' 대신 '해야 할 것'을 말하세요.**
   - 다음 대신: "응답에 마크다운을 사용하지 마세요"
   - 다음과 같이 시도해 보세요: "당신의 응답은 매끄럽게 흐르는 산문 단락으로 구성되어야 합니다"
2. **원하는 출력에 맞춰 프롬프트 스타일을 일치시키세요.**
   - 프롬프트에 사용된 형식 스타일은 AI의 응답 스타일에 영향을 미칠 수 있습니다. 최소한의 마크다운을 원한다면 프롬프트에서 마크다운을 줄이세요.
3. **형식 선호도에 대해 명시적이세요.**
   - 형식에 대한 자세한 제어를 위해서는:
     - 보고서나 분석을 작성할 때 완전한 단락을 사용하여 명확하고 유려한 산문으로 작성하십시오. 구성을 위해 표준 단락 나누기를 사용하십시오. 마크다운은 주로 인라인 코드, 코드 블록 및 간단한 제목에 한하여 사용하십시오.
     - **순서가 지정된 목록 또는 순서가 지정되지 않은 목록을 사용하지 마십시오.** 목록 형식이 최선의 선택인 진정으로 개별적인 항목을 제시하는 경우, 또는 사용자가 명시적으로 목록을 요청하는 경우가 아니라면 사용하지 마십시오.
     - 항목을 글머리 기호로 나열하는 대신, 문장에 자연스럽게 통합하십시오. 당신의 목표는 독자를 아이디어를 통해 자연스럽게 안내하는, 읽기 쉽고 유려하게 흐르는 텍스트입니다.

### 프롬프트 체이닝 (Prompt chaining)

이전 기술들과 달리, 프롬프트 체이닝은 단일 프롬프트로 구현할 수 없습니다. 체이닝은 복잡한 작업을 개별 프롬프트와 함께 더 작고 순차적인 단계로 분해합니다. 각 프롬프트는 하나의 단계를 처리하며, 그 출력은 다음 명령으로 피드됩니다.

이 접근 방식은 각 개별 작업을 더 쉽게 만듦으로써 지연 시간과 정확성을 교환합니다. 일반적으로 이 기술은 워크플로 또는 프로그래밍 방식으로 구현되지만, 응답을 받은 후 프롬프트를 수동으로 제공할 수도 있습니다.

**예시: 연구 요약**

- **첫 번째 프롬프트:** "방법론, 연구 결과, 임상적 의미를 다루는 이 의학 논문을 요약해 주세요."
- **두 번째 프롬프트:** "위 요약의 정확성, 명확성 및 완전성을 검토하세요. 등급이 매겨진 피드백을 제공하세요."
- **세 번째 프롬프트:** "이 피드백을 바탕으로 요약을 개선하세요: 2단계의 피드백"

각 단계는 집중된 명령을 통해 개선을 추가합니다.

**프롬프트 체이닝을 사용해야 할 때:**

- 여러 단계로 나누어야 하는 복잡한 요청이 있을 때
- 반복적인 개선이 필요할 때
- 다단계 분석을 수행하고 있을 때
- 중간 유효성 검사가 가치를 더할 때
- 단일 프롬프트가 일관되지 않은 결과를 생성할 때

**장단점:** 체이닝은 지연 시간(여러 API 호출)을 증가시키지만, 복잡한 작업의 정확성과 신뢰성을 크게 향상시키는 경우가 많습니다.

## 들어봤을 만한 기법

> 이전 AI 모델에서 인기가 있었던 일부 프롬프트 엔지니어링 기법들은 최신 모델에서는 덜 필요합니다. 하지만 오래된 문서에서 여전히 접하거나 특정 상황에서 유용하다는 것을 알 수 있습니다.

### 구조를 위한 XML 태그

XML 태그는 한때 프롬프트에 구조와 명확성을 추가하는 권장되는 방식이었으며, 특히 대량의 데이터를 포함할 때 그러했습니다. 최신 모델은 XML 태그 없이도 구조를 더 잘 이해하지만, 특정 상황에서는 여전히 유용할 수 있습니다.

**XML 태그가 여전히 도움이 될 수 있는 경우:**

- 여러 유형의 콘텐츠가 혼합된 **극도로 복잡한 프롬프트**로 작업하는 경우
- 콘텐츠 경계에 대해 **절대적으로 확신**이 필요한 경우
- **이전 모델 버전**으로 작업하는 경우

**최신 대안:** 대부분의 사용 사례에서는 명확한 제목, 공백, 명시적인 언어("아래 운동선수 정보를 사용하여...")가 오버헤드 없이 최신 모델에서 동일하게 작동합니다.

### 역할 프롬프팅 (Role prompting)

역할 프롬프팅은 쿼리를 구성하는 방식에서 전문가 페르소나와 관점을 정의합니다. 이것이 효과적일 수 있지만, 최신 모델은 정교하여 **과도한** 역할 프롬프팅이 종종 불필요합니다.

**예시:** "당신은 재무 자문가입니다. 이 투자 포트폴리오를 분석하세요..."

**중요한 주의사항:** 역할을 지나치게 제한하지 마십시오. "당신은 도움이 되는 비서입니다"가 "당신은 전문 용어로만 말하고 실수하지 않는 세계적으로 유명한 전문가입니다"보다 종종 더 좋습니다. 지나치게 구체적인 역할은 AI의 유용성을 제한할 수 있습니다.

**역할 프롬프팅이 도움이 될 수 있는 경우:**

- 많은 출력에 걸쳐 **일관된 톤**이 필요한 경우
- **특정 페르소나**가 필요한 애플리케이션을 구축하는 경우
- 복잡한 주제에 대해 **도메인 전문 지식의 틀**을 원하는 경우

**최신 대안:** 종종 원하는 관점이 무엇인지 명시적으로 밝히는 것이 더 효과적입니다. 역할을 할당하는 것보다 "위험 허용 범위와 장기 성장 잠재력에 초점을 맞춰 이 투자 포트폴리오를 분석하세요"와 같이 명시하는 것이 좋습니다.

### Putting it all together

> 프롬프트 엔지니어링의 기술은 사용 가능한 모든 기술을 사용하는 것이 아니라, **특정 요구 사항에 맞는 올바른 조합을 선택**하는 것입니다.
> 기억하십시오: 최고의 프롬프트는 **가장 길거나 가장 복잡한 것**이 아닙니다. 최소한의 필요한 구조로 **목표를 안정적으로 달성**하는 프롬프트입니다. 연습을 하면서, 어떤 기법이 어떤 상황에 적합한지에 대한 직관을 개발하게 될 것입니다.

```prompt
이 분기 보고서에서 주요 재무 지표를 추출하여 JSON 형식으로 제시하세요

이 데이터는 자동 처리를 위해 필요하므로 응답에는 설명 없이 유효한 JSON만 포함되어야 합니다

다음 구조를 사용하세요
{
  "revenue": "단위가 포함된 값",
  "profit_margin": "백분율",
  "growth_rate": "백분율"
}

보고서에 명확히 제시되지 않은 지표는 추측하지 말고 null을 사용하세요

응답은 여는 중괄호로 시작하세요 {
```

## 일반적인 프롬프트 문제 해결

의도가 좋은 프롬프트라도 예상치 못한 결과를 낳을 수 있습니다. 일반적인 문제점과 해결 방법은 다음과 같습니다.

- **문제:** 응답이 너무 일반적임
  → **해결책:** 구체성, 예시, 또는 포괄적인 결과물에 대한 명시적 요청을 추가하세요. AI에게 "기본을 넘어서라"고 요청하세요.
- **문제:** 응답이 주제를 벗어나거나 요점을 놓침
  → **해결책:** 실제 목표에 대해 더 명시적으로 말하세요. 질문하는 이유에 대한 맥락을 제공하세요.
- **문제:** 응답 형식이 일관되지 않음
  → **해결책:** 예시(Few-shot)를 추가하거나, 응답의 시작을 제어하기 위해 선입력(prefilling)을 사용하세요.
- **문제:** 작업이 너무 복잡하여 결과가 신뢰할 수 없음
  → **해결책:** 여러 프롬프트로 나누세요(체이닝). 각 프롬프트는 하나의 작업을 잘 수행해야 합니다.
- **문제:** AI가 불필요한 서론을 포함함
  → **해결책:** 선입력을 사용하거나 명시적으로 요청하세요: "서론을 생략하고 바로 답변하세요."
- **문제:** AI가 정보를 지어냄
  → **해결책:** 불확실할 때 "모르겠다"고 말할 수 있는 명시적인 허가를 주세요.
- **문제:** 구현을 원했는데 AI가 변경 사항을 제안함
  → **해결책:** "변경 사항을 제안해 줄 수 있나요?" 대신 "이 함수를 변경하세요"와 같이 행동에 대해 명시하세요.

> **프로 팁:** 간단하게 시작하고 필요할 때만 복잡성을 추가하세요. 각 추가 사항이 실제로 결과를 개선하는지 테스트해 보세요.

### 피해야 할 일반적인 실수

시간을 절약하고 프롬프트를 개선하기 위해 다음의 일반적인 함정으로부터 배우세요.

- **과도하게 설계하지 마세요:** 더 길고 복잡한 프롬프트가 항상 더 나은 것은 아닙니다.
- **기본 사항을 무시하지 마세요:** 핵심 프롬프트가 불분명하거나 모호하면 고급 기술도 도움이 되지 않습니다.
- **AI가 마음을 읽는다고 가정하지 마세요:** 원하는 것에 대해 구체적으로 말하세요. 모호하게 남겨두면 AI가 잘못 해석할 여지가 생깁니다.
- **모든 기술을 한 번에 사용하지 마세요:** 특정 문제를 해결하는 기술을 선택하세요.
- **반복하는 것을 잊지 마세요:** 첫 번째 프롬프트가 완벽하게 작동하는 경우는 드뭅니다. 테스트하고 다듬으세요.
- **오래된 기술에 의존하지 마세요:** 최신 모델에서는 XML 태그와 무거운 역할 부여(role prompting)가 덜 필요합니다. 명시적이고 명확한 지침으로 시작하세요.

## 프롬프트 엔지니어링 고려 사항

### 긴 콘텐츠 작업

**전략:** 긴 컨텍스트로 작업할 때는 정보를 **가장 중요한 세부 사항**을 **시작**이나 **끝**에 두고 명확하게 구성하십시오. 복잡한 작업으로 작업할 때는, 그것들을 집중된 하위 작업으로 나누는 것이 각 구성 요소의 품질과 신뢰성을 향상시킬 수 있는지 고려해 보십시오.

### 좋은 프롬프트는 어떤 모습일까요?

**빠른 평가 팁:**

- 출력이 **특정 요구 사항**과 일치합니까?
- **한 번의 시도**로 결과를 얻었습니까, 아니면 여러 번의 반복이 필요했습니까?
- 여러 번의 시도에서 형식이 **일관적**입니까?
- 위에 나열된 **흔한 실수**를 피하고 있습니까?
